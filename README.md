## Event Bot

Телеграм-бот для управления офлайн/онлайн событиями: создание мероприятий, регистрация участников, управление списками и напоминаниями прямо из Telegram.

### Основные возможности
- Пошаговое создание событий через интерактивные сообщения и календарь.
- Выбор даты и времени с помощью inline-клавиатур.
- Регистрация/отмена участия пользователей и контроль квот (через репозиторий регистраций).
- Админские действия (создание, удаление и архивирование событий доступны только администраторам).
- Просмотр архива событий и скрытие архивных записей из списка активных мероприятий.
- Хранение данных в SQLite с сохранением состояния незавершённых диалогов.

### Требования
- Go 1.23+
- GNU Make
- SQLite3 (для инициализации базы данных)
- Telegram Bot Token

### Быстрый старт
1. **Склонируйте репозиторий**
   ```bash
   git clone https://github.com/binaryty/evbot.git
   cd evbot
   ```
2. **Создайте конфиг** `config/config.yaml`:
   ```yaml
   bot_token: "123456:REPLACE_ME"
   admin_ids:
     - 141431779
     - 299193506
   db_path: "events.db"
   ```
3. **Инициализируйте/обновите базу:**
   ```bash
   sqlite3 events.db < migrations/init.sql
   # примените новые миграции по порядку
   sqlite3 events.db < migrations/002_add_event_archive.sql
   ```
4. **Запустите бота локально:**
   ```bash
   make run CONFIG=config/config.yaml
   ```

> Альтернатива: можно передать путь к конфигу через `CONFIG_PATH=/path/to/config.yaml make run` или флаг `-config` при запуске бинаря.

### Основные команды Makefile
| Команда | Описание |
| --- | --- |
| `make build` | Сборка бинаря в `bin/evbot` |
| `make run` | Запуск бота (по умолчанию берёт `config/config.yaml`) |
| `make test` | Прогон всех тестов `go test ./...` |
| `make lint` | Проверка форматирования (gofmt) + `go vet` |
| `make fmt` | Автоформатирование исходников |
| `make tidy` | Обновление `go.mod/go.sum` |
| `make ci` | Композитная цель: `lint` + `test` (используется в GitHub Actions) |

### CI/CD
Файл `.github/workflows/ci.yml` запускает пайплайн при push/PR в `main`:
1. Checkout репозитория.
2. Установка версии Go из `go.mod`.
3. Кэширование зависимостей и `go build` артефактов.
4. `make ci` — форматирование, `go vet`, тесты.

Пайплайн служит базовой защитой от регрессий и гарантирует единый стиль кода.

### Полезные переменные окружения
- `CONFIG_PATH` — путь к `config.yaml`. Если не задан, необходимо передавать `-config` при запуске.
- `ADMIN_IDS` задаются в конфиге, но их можно изменить и пересобрать приложение.

### Структура проекта
- `cmd/main.go` — входная точка приложения.
- `internal/app` — инициализация логгера, БД, бота и запуск обработчиков.
- `internal/delivery/telegram` — слой взаимодействия с Telegram API, обработчики состояний/колбеков.
- `internal/repository/sqlite` — репозитории для SQLite.
- `internal/usecase` — бизнес-логика.
- `migrations` — SQL-миграции для базы данных.

### Разработка и вклад
1. Создайте ветку от `main`.
2. Внесите изменения, прогоните `make ci`.
3. Откройте Pull Request — GitHub Actions автоматически проверит сборку и тесты.

Если вы обнаружили баги или хотите предложить улучшения, создавайте Issue/PR. Contributions приветствуются!

